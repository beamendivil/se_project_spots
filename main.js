!function(){"use strict";function e(e,t,a){const r=e.querySelector(`#${t.id}-error`);r&&(r.textContent="",r.classList.remove(a.errorClass),t.classList.remove(a.inputErrorClass))}function t(e,t,a){!function(e){return e.some(e=>!e.validity.valid)}(e)?(t.classList.remove(a.inactiveButtonClass),t.disabled=!1):(t.classList.add(a.inactiveButtonClass),t.disabled=!0)}function a(a,r){const n=Array.from(a.querySelectorAll(r.inputSelector)),o=a.querySelector(r.submitButtonSelector);n.forEach(t=>{e(a,t,r)}),t(n,o,r)}function r(e,t){a(e,t),e.reset()}const n="Server error. Please try again later.",o=".modal__submit-btn",s="#edit-modal",i="#add-card-modal",l="#preview-modal",c="#avatar-modal",d="#confirm-modal",u="#profile-name-input",m="#profile-description-input",h="#add-card-name-input",p="#add-card-link-input",f="#avatar-link-input",_="Creating...",v="Create",g="Deleting...",b=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():e.json().then(t=>{const a=t.message||`Error: ${e.status}`;return Promise.reject({status:e.status,message:a})}).catch(()=>Promise.reject({status:e.status,message:e.statusText||`Error: ${e.status}`}))}_request(e,t){return fetch(e,t).then(this._checkResponse)}getUserInfo(){return this._request(`${this._baseUrl}/users/me`,{headers:this._headers})}updateUserInfo(e){return this._request(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)})}updateAvatar(e){return this._request(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)})}getInitialCards(){return this._request(`${this._baseUrl}/cards`,{headers:this._headers})}addCard(e){return this._request(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify(e)})}deleteCard(e){return this._request(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers})}addLike(e){return this._request(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers})}removeLike(e){return this._request(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers})}changeLikeCardStatus(e,t){return t?this.removeLike(e):this.addLike(e)}getAppInfo(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"12c3a7ea-f9fe-4d1a-b905-983f501aca74","Content-Type":"application/json"}}),y=[{name:"Val Thorens",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/1-photo-by-moritz-feldmann-from-pexels.jpg"},{name:"Restaurant terrace",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/2-photo-by-ceiline-from-pexels.jpg"},{name:"An outdoor cafe",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/3-photo-by-tubanur-dogan-from-pexels.jpg"},{name:"A very long bridge, over the forest and through the trees",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/4-photo-by-maurice-laschet-from-pexels.jpg"},{name:"Tunnel with morning light",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/5-photo-by-van-anh-nguyen-from-pexels.jpg"},{name:"Mountain house",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/6-photo-by-moritz-feldmann-from-pexels.jpg"}];function k(e){if("Escape"===e.key){const e=document.querySelector(".modal_opened");e&&Z(e)}}function S(e,t,a="Saving...",r="Save"){e?(t.textContent=a,t.disabled=!0):(t.textContent=r,t.disabled=!1)}function L(e){if(console.error("API Error:",e),e.status)switch(e.status){case 400:alert("Please check your input and try again.");break;case 401:alert("Authentication failed. Please log in again.");break;case 404:alert("Resource not found.");break;case 500:alert(n);break;default:alert(e.message||n)}else alert("Network error. Please check your connection.")}function C(e){const t=document.querySelector(e);return t||console.warn(`Element not found: ${e}`),t}const q={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"};var E;E=q,Array.from(document.querySelectorAll(E.formSelector)).forEach(a=>{!function(a,r){const n=Array.from(a.querySelectorAll(r.inputSelector)),o=a.querySelector(r.submitButtonSelector);t(n,o,r),n.forEach(s=>{s.addEventListener("input",()=>{!function(t,a,r){a.validity.valid?e(t,a,r):function(e,t,a,r){const n=e.querySelector(`#${t.id}-error`);n&&(n.textContent=a,n.classList.add(r.errorClass),t.classList.add(r.inputErrorClass))}(t,a,a.validationMessage,r)}(a,s,r),t(n,o,r)})})}(a,E)});const w=C(".cards__list"),A=C("#card-template")?.content.querySelector(".card"),U=C(".profile__edit-btn"),x=C(".profile__add-btn"),$=C(".profile__avatar-edit-btn"),j=C(s),D=C(i),P=C(l),z=C(c),I=C(d),T=C(`${s} .modal__form`),N=C(`${i} .modal__form`),B=C(`${c} .modal__form`),R=T?.querySelector(u),O=T?.querySelector(m),H=C(".profile__name"),J=C(".profile__description"),M=C(".profile__avatar"),F=N?.querySelector(h),W=N?.querySelector(p),Y=B?.querySelector(f),V=P?.querySelector(".modal__image"),G=P?.querySelector(".modal__caption");function K(){if(!ne)return;const{cardData:e,cardElement:t}=ne,a=I.querySelector(o);S(!0,a,g,"Yes"),b.deleteCard(e._id).then(()=>{t.remove(),Z(I),ne=null}).catch(L).finally(()=>{S(!1,a,g,"Yes")})}function Q(e,t){console.log("Creating card with data:",e);const a=A.cloneNode(!0),r=a.querySelector(".card__image"),n=a.querySelector(".card__title"),o=a.querySelector(".card__like-btn"),s=a.querySelector(".card__delete-btn");return r.src=e.link,r.alt=e.name,n.textContent=e.name,console.log("Setting image src to:",e.link),e.isLiked&&o.classList.add("card__like-btn_liked"),o.addEventListener("click",()=>function(e,t){const a=t.classList.contains("card__like-btn_liked");b.changeLikeCardStatus(e._id,a).then(a=>{t.classList.toggle("card__like-btn_liked"),e.isLiked=a.isLiked}).catch(L)}(e,o)),s.addEventListener("click",()=>function(e,t){ne={cardData:e,cardElement:t},X(I)}(e,a)),r.addEventListener("click",()=>function(e){V.src=e.link,V.alt=e.name,G.textContent=e.name,X(P)}(e)),a}function X(e){e.classList.add("modal_opened"),document.addEventListener("keydown",k)}function Z(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",k)}function ee(e){e.preventDefault();const t=e.target.querySelector(o),a=R.value.trim(),r=O.value.trim();""!==a&&""!==r?(S(!0,t),b.updateUserInfo({name:a,about:r}).then(e=>{H.textContent=e.name,J.textContent=e.about,re=e,Z(j)}).catch(L).finally(()=>{S(!1,t)})):alert("Both name and description must be filled out.")}function te(e){e.preventDefault();const t=e.target.querySelector(o),a=F.value.trim(),n=W.value.trim();""!==a&&""!==n?(S(!0,t,_,v),b.addCard({name:a,link:n}).then(e=>{console.log("New card received from API:",e);const t=Q(e,re._id);w.prepend(t),N.reset(),r(N,q),Z(D)}).catch(L).finally(()=>{S(!1,t,_,v)})):alert("Both name and link must be filled out.")}function ae(e){e.preventDefault();const t=e.target.querySelector(o),a=Y.value.trim();""!==a?(S(!0,t),b.updateAvatar({avatar:a}).then(e=>{oe(e.avatar,e.name||"User Avatar"),re=e,B.reset(),r(B,q),Z(z)}).catch(L).finally(()=>{S(!1,t)})):alert("Avatar link must be filled out.")}let re=null,ne=null;function oe(e,t="User Avatar"){if(!M)return void console.warn("profileAvatar element not found");if(!e||""===e.trim())return void console.log("No avatar URL provided, keeping current avatar");const a=M.src;e.startsWith("./"),console.log("Current avatar src:",a),console.log("New avatar URL:",e),e===a||a.endsWith(e)?console.log("Avatar already set to this URL, skipping"):(console.log("Setting avatar to:",e),M.src=e,M.alt=t,M.onerror=function(){console.warn("Avatar failed to load, using fallback"),this.src="images/avatar.jpg",this.alt="Default Avatar",this.onerror=null})}function se(){console.log("Initializing app..."),b.getAppInfo().then(([e,t])=>{console.log("User data received:",e),re=e,H.textContent=e.name||"User Name",J.textContent=e.about||"User Description",e.avatar&&!e.avatar.includes("practicum-content.s3.amazonaws.com")?oe(e.avatar,e.name||"User Avatar"):console.log("Using default avatar (no custom avatar or placeholder detected)"),ie(t)}).catch(e=>{console.error("Failed to initialize app:",e),oe("./images/avatar.jpg","Default Avatar"),H.textContent="User Name",J.textContent="User Description",ie(y)})}function ie(e){const t=document.createDocumentFragment();e.forEach(e=>{const a=Q(e,re&&re._id);t.appendChild(a)}),w.innerHTML="",w.appendChild(t)}se(),se(),function(){N?.addEventListener("submit",te),T?.addEventListener("submit",ee),B?.addEventListener("submit",ae);const e=I?.querySelector(o),t=I?.querySelector(".modal__cancel-btn");e?.addEventListener("click",K),t?.addEventListener("click",()=>{Z(I),ne=null}),U?.addEventListener("click",()=>{a(T,q),re?(R.value=re.name,O.value=re.about||""):(R.value=H.textContent,O.value=J.textContent),X(j)}),x?.addEventListener("click",()=>{r(N,q),X(D)}),$?.addEventListener("click",()=>{r(B,q),X(z)}),document.querySelectorAll(".modal__close-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.closest(".modal");Z(t),t===I&&(ne=null)})}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",t=>{t.target===e&&(Z(e),e===I&&(ne=null))})})}()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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bi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLW1haW4vLi9zcmMvc2NyaXB0cy9jb25maWcuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy1tYWluLy4vc3JjL3NjcmlwdHMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy1tYWluLy4vc3JjL3NjcmlwdHMvYXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBlbmFibGVWYWxpZGF0aW9uKGNvbmZpZykge1xuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKSk7XG5cbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybSkgPT4ge1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm0sIGNvbmZpZyk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybSwgY29uZmlnKSB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybS5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcblxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm0sIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtLCBpbnB1dEVsZW1lbnQsIGNvbmZpZykge1xuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKGZvcm0sIGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm0sIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzaG93SW5wdXRFcnJvcihmb3JtLCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSwgY29uZmlnKSB7XG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm0ucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICBpZiAoZXJyb3JFbGVtZW50KSB7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5lcnJvckNsYXNzKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTsgLy8gQWRkIGlucHV0IGVycm9yIGNsYXNzXG4gIH1cbn1cblxuZnVuY3Rpb24gaGlkZUlucHV0RXJyb3IoZm9ybSwgaW5wdXRFbGVtZW50LCBjb25maWcpIHtcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybS5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gIGlmIChlcnJvckVsZW1lbnQpIHtcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5lcnJvckNsYXNzKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTsgLy8gUmVtb3ZlIGlucHV0IGVycm9yIGNsYXNzXG4gIH1cbn1cblxuZnVuY3Rpb24gdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpIHtcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSB7XG4gIHJldHVybiBpbnB1dExpc3Quc29tZSgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJWYWxpZGF0aW9uKGZvcm0sIGNvbmZpZykge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm0ucXVlcnlTZWxlY3RvckFsbChjb25maWcuaW5wdXRTZWxlY3RvcikpO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybS5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm0sIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgfSk7XG5cbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVzZXRGb3JtKGZvcm0sIGNvbmZpZykge1xuICBjbGVhclZhbGlkYXRpb24oZm9ybSwgY29uZmlnKTtcbiAgZm9ybS5yZXNldCgpO1xufVxuIiwiLy8gQVBJIENvbmZpZ3VyYXRpb24gLSBVc2UgeW91ciBUcmlwbGVUZW4gc3R1ZGVudCB0b2tlbiBoZXJlXG5leHBvcnQgY29uc3QgQVBJX0NPTkZJRyA9IHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCIxMmMzYTdlYS1mOWZlLTRkMWEtYjkwNS05ODNmNTAxYWNhNzRcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn07XG5cbi8vIEZhbGxiYWNrIGNvbmZpZ3VyYXRpb24gZm9yIGRldmVsb3BtZW50L2RlbW8gcHVycG9zZXNcbmV4cG9ydCBjb25zdCBGQUxMQkFDS19DT05GSUcgPSB7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9qc29ucGxhY2Vob2xkZXIudHlwaWNvZGUuY29tXCIsIC8vIE1vY2sgQVBJIGZvciBkZW1vXG4gIGhlYWRlcnM6IHtcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn07IC8vIEFsdGVybmF0aXZlIGNvbmZpZ3VyYXRpb24gZm9yIGRpZmZlcmVudCBlbnZpcm9ubWVudHNcbmV4cG9ydCBjb25zdCBnZXRBcGlDb25maWcgPSAoKSA9PiB7XG4gIGNvbnN0IGlzRGV2ZWxvcG1lbnQgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJkZXZlbG9wbWVudFwiO1xuXG4gIHJldHVybiB7XG4gICAgYmFzZVVybDogaXNEZXZlbG9wbWVudFxuICAgICAgPyBcImh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC92MVwiXG4gICAgICA6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgICBoZWFkZXJzOiB7XG4gICAgICBhdXRob3JpemF0aW9uOiBcIjEyYzNhN2VhLWY5ZmUtNGQxYS1iOTA1LTk4M2Y1MDFhY2E3NFwiLFxuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgfSxcbiAgfTtcbn07XG5cbi8vIEVycm9yIG1lc3NhZ2VzIGZvciBiZXR0ZXIgVVhcbmV4cG9ydCBjb25zdCBFUlJPUl9NRVNTQUdFUyA9IHtcbiAgTkVUV09SS19FUlJPUjogXCJOZXR3b3JrIGVycm9yLiBQbGVhc2UgY2hlY2sgeW91ciBjb25uZWN0aW9uLlwiLFxuICBTRVJWRVJfRVJST1I6IFwiU2VydmVyIGVycm9yLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiLFxuICBWQUxJREFUSU9OX0VSUk9SOiBcIlBsZWFzZSBjaGVjayB5b3VyIGlucHV0IGFuZCB0cnkgYWdhaW4uXCIsXG4gIEFVVEhfRVJST1I6IFwiQXV0aGVudGljYXRpb24gZmFpbGVkLiBQbGVhc2UgbG9nIGluIGFnYWluLlwiLFxufTtcbiIsImltcG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIHJlc2V0Rm9ybSwgY2xlYXJWYWxpZGF0aW9uIH0gZnJvbSBcIi4vdmFsaWRhdGlvbi5qc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi9hcGkuanNcIjtcbmltcG9ydCB7IEFQSV9DT05GSUcsIEVSUk9SX01FU1NBR0VTIH0gZnJvbSBcIi4vY29uZmlnLmpzXCI7XG5pbXBvcnQgXCIuLi9wYWdlcy9pbmRleC5jc3NcIjtcblxuLy8gQ29uc3RhbnRzIGFuZCBTZWxlY3RvcnNcbmNvbnN0IFNFTEVDVE9SUyA9IHtcbiAgY2FyZHNMaXN0OiBcIi5jYXJkc19fbGlzdFwiLFxuICBjYXJkVGVtcGxhdGU6IFwiI2NhcmQtdGVtcGxhdGVcIixcbiAgY2FyZDogXCIuY2FyZFwiLFxuICBjYXJkSW1hZ2U6IFwiLmNhcmRfX2ltYWdlXCIsXG4gIGNhcmRUaXRsZTogXCIuY2FyZF9fdGl0bGVcIixcbiAgY2FyZExpa2VCdG46IFwiLmNhcmRfX2xpa2UtYnRuXCIsXG4gIGNhcmREZWxldGVCdG46IFwiLmNhcmRfX2RlbGV0ZS1idG5cIixcbiAgcHJvZmlsZUVkaXRCdG46IFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIsXG4gIHByb2ZpbGVBZGRCdG46IFwiLnByb2ZpbGVfX2FkZC1idG5cIixcbiAgcHJvZmlsZU5hbWU6IFwiLnByb2ZpbGVfX25hbWVcIixcbiAgcHJvZmlsZURlc2NyaXB0aW9uOiBcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiLFxuICBwcm9maWxlQXZhdGFyOiBcIi5wcm9maWxlX19hdmF0YXJcIixcbiAgcHJvZmlsZUF2YXRhckVkaXRCdG46IFwiLnByb2ZpbGVfX2F2YXRhci1lZGl0LWJ0blwiLFxuICBtb2RhbE9wZW5lZDogXCIubW9kYWxfb3BlbmVkXCIsXG4gIG1vZGFsU3VibWl0QnRuOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICBtb2RhbENhbmNlbEJ0bjogXCIubW9kYWxfX2NhbmNlbC1idG5cIixcbiAgbW9kYWxzOiB7XG4gICAgZWRpdDogXCIjZWRpdC1tb2RhbFwiLFxuICAgIGFkZENhcmQ6IFwiI2FkZC1jYXJkLW1vZGFsXCIsXG4gICAgcHJldmlldzogXCIjcHJldmlldy1tb2RhbFwiLFxuICAgIGF2YXRhcjogXCIjYXZhdGFyLW1vZGFsXCIsXG4gICAgY29uZmlybTogXCIjY29uZmlybS1tb2RhbFwiLFxuICB9LFxuICBpbnB1dHM6IHtcbiAgICBwcm9maWxlTmFtZTogXCIjcHJvZmlsZS1uYW1lLWlucHV0XCIsXG4gICAgcHJvZmlsZURlc2NyaXB0aW9uOiBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCIsXG4gICAgY2FyZE5hbWU6IFwiI2FkZC1jYXJkLW5hbWUtaW5wdXRcIixcbiAgICBjYXJkTGluazogXCIjYWRkLWNhcmQtbGluay1pbnB1dFwiLFxuICAgIGF2YXRhckxpbms6IFwiI2F2YXRhci1saW5rLWlucHV0XCIsXG4gIH0sXG4gIGNsb3NlQnV0dG9uczogXCIubW9kYWxfX2Nsb3NlLWJ0blwiLFxuICBwcmV2aWV3Q2xvc2VCdG46IFwiLm1vZGFsX19jbG9zZS1idG5fdHlwZV9wcmV2aWV3XCIsXG4gIG1vZGFsSW1hZ2U6IFwiLm1vZGFsX19pbWFnZVwiLFxuICBtb2RhbENhcHRpb246IFwiLm1vZGFsX19jYXB0aW9uXCIsXG59O1xuXG5jb25zdCBCVVRUT05fVEVYVCA9IHtcbiAgc2F2aW5nOiBcIlNhdmluZy4uLlwiLFxuICBzYXZlOiBcIlNhdmVcIixcbiAgY3JlYXRpbmc6IFwiQ3JlYXRpbmcuLi5cIixcbiAgY3JlYXRlOiBcIkNyZWF0ZVwiLFxuICBkZWxldGluZzogXCJEZWxldGluZy4uLlwiLFxuICBkZWxldGU6IFwiWWVzXCIsXG59O1xuXG4vLyBJbml0aWFsaXplIEFQSVxuY29uc3QgYXBpID0gbmV3IEFwaShBUElfQ09ORklHKTtcbi8vIEtlZXAgaW5pdGlhbCBjYXJkcyBhcyBmYWxsYmFja1xuY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICB7XG4gICAgbmFtZTogXCJWYWwgVGhvcmVuc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiUmVzdGF1cmFudCB0ZXJyYWNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzItcGhvdG8tYnktY2VpbGluZS1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQW4gb3V0ZG9vciBjYWZlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzMtcGhvdG8tYnktdHViYW51ci1kb2dhbi1mcm9tLXBleGVscy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQSB2ZXJ5IGxvbmcgYnJpZGdlLCBvdmVyIHRoZSBmb3Jlc3QgYW5kIHRocm91Z2ggdGhlIHRyZWVzXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzQtcGhvdG8tYnktbWF1cmljZS1sYXNjaGV0LWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJUdW5uZWwgd2l0aCBtb3JuaW5nIGxpZ2h0XCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzUtcGhvdG8tYnktdmFuLWFuaC1uZ3V5ZW4tZnJvbS1wZXhlbHMuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIk1vdW50YWluIGhvdXNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzYtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuICB9LFxuXTtcblxuZnVuY3Rpb24gaGFuZGxlRXNjQ2xvc2UoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3BlbmVkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5lZFwiKTtcbiAgICBpZiAob3BlbmVkTW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwob3BlbmVkTW9kYWwpO1xuICAgIH1cbiAgfVxufVxuXG4vLyBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgbG9hZGluZyBzdGF0ZXMgYW5kIGVycm9yIGhhbmRsaW5nXG5mdW5jdGlvbiByZW5kZXJMb2FkaW5nKFxuICBpc0xvYWRpbmcsXG4gIGJ1dHRvbixcbiAgbG9hZGluZ1RleHQgPSBCVVRUT05fVEVYVC5zYXZpbmcsXG4gIGRlZmF1bHRUZXh0ID0gQlVUVE9OX1RFWFQuc2F2ZVxuKSB7XG4gIGlmIChpc0xvYWRpbmcpIHtcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcbiAgICBidXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICB9IGVsc2Uge1xuICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGRlZmF1bHRUZXh0O1xuICAgIGJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVycm9yKGVycm9yKSB7XG4gIGNvbnNvbGUuZXJyb3IoXCJBUEkgRXJyb3I6XCIsIGVycm9yKTtcblxuICAvLyBNb3JlIHNwZWNpZmljIGVycm9yIGhhbmRsaW5nIGJhc2VkIG9uIHN0YXR1cyBjb2RlXG4gIGlmIChlcnJvci5zdGF0dXMpIHtcbiAgICBzd2l0Y2ggKGVycm9yLnN0YXR1cykge1xuICAgICAgY2FzZSA0MDA6XG4gICAgICAgIGFsZXJ0KEVSUk9SX01FU1NBR0VTLlZBTElEQVRJT05fRVJST1IpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDAxOlxuICAgICAgICBhbGVydChFUlJPUl9NRVNTQUdFUy5BVVRIX0VSUk9SKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQwNDpcbiAgICAgICAgYWxlcnQoXCJSZXNvdXJjZSBub3QgZm91bmQuXCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTAwOlxuICAgICAgICBhbGVydChFUlJPUl9NRVNTQUdFUy5TRVJWRVJfRVJST1IpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGFsZXJ0KGVycm9yLm1lc3NhZ2UgfHwgRVJST1JfTUVTU0FHRVMuU0VSVkVSX0VSUk9SKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgYWxlcnQoRVJST1JfTUVTU0FHRVMuTkVUV09SS19FUlJPUik7XG4gIH1cbn1cblxuLy8gVXRpbGl0eSBmdW5jdGlvbiB0byBnZXQgRE9NIGVsZW1lbnRzIHNhZmVseVxuZnVuY3Rpb24gZ2V0RWxlbWVudChzZWxlY3Rvcikge1xuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3Rvcik7XG4gIGlmICghZWxlbWVudCkge1xuICAgIGNvbnNvbGUud2FybihgRWxlbWVudCBub3QgZm91bmQ6ICR7c2VsZWN0b3J9YCk7XG4gIH1cbiAgcmV0dXJuIGVsZW1lbnQ7XG59XG5cbmNvbnN0IHZhbGlkYXRpb25Db25maWcgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnRuX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXG59O1xuXG4vLyBFbmFibGUgZm9ybSB2YWxpZGF0aW9uXG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpO1xuXG4vLyBET00gRWxlbWVudHNcbmNvbnN0IGNhcmRzTGlzdCA9IGdldEVsZW1lbnQoU0VMRUNUT1JTLmNhcmRzTGlzdCk7XG5jb25zdCBjYXJkVGVtcGxhdGUgPSBnZXRFbGVtZW50KFNFTEVDVE9SUy5jYXJkVGVtcGxhdGUpPy5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFNFTEVDVE9SUy5jYXJkXG4pO1xuXG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGdldEVsZW1lbnQoU0VMRUNUT1JTLnByb2ZpbGVFZGl0QnRuKTtcbmNvbnN0IGNhcmRBZGRCdXR0b24gPSBnZXRFbGVtZW50KFNFTEVDVE9SUy5wcm9maWxlQWRkQnRuKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXJFZGl0QnV0dG9uID0gZ2V0RWxlbWVudChTRUxFQ1RPUlMucHJvZmlsZUF2YXRhckVkaXRCdG4pO1xuXG5jb25zdCBlZGl0TW9kYWwgPSBnZXRFbGVtZW50KFNFTEVDVE9SUy5tb2RhbHMuZWRpdCk7XG5jb25zdCBhZGRDYXJkTW9kYWwgPSBnZXRFbGVtZW50KFNFTEVDVE9SUy5tb2RhbHMuYWRkQ2FyZCk7XG5jb25zdCBwcmV2aWV3TW9kYWwgPSBnZXRFbGVtZW50KFNFTEVDVE9SUy5tb2RhbHMucHJldmlldyk7XG5jb25zdCBhdmF0YXJNb2RhbCA9IGdldEVsZW1lbnQoU0VMRUNUT1JTLm1vZGFscy5hdmF0YXIpO1xuY29uc3QgY29uZmlybU1vZGFsID0gZ2V0RWxlbWVudChTRUxFQ1RPUlMubW9kYWxzLmNvbmZpcm0pO1xuXG5jb25zdCBlZGl0Rm9ybUVsZW1lbnQgPSBnZXRFbGVtZW50KGAke1NFTEVDVE9SUy5tb2RhbHMuZWRpdH0gLm1vZGFsX19mb3JtYCk7XG5jb25zdCBhZGRDYXJkRm9ybUVsZW1lbnQgPSBnZXRFbGVtZW50KFxuICBgJHtTRUxFQ1RPUlMubW9kYWxzLmFkZENhcmR9IC5tb2RhbF9fZm9ybWBcbik7XG5jb25zdCBhdmF0YXJGb3JtRWxlbWVudCA9IGdldEVsZW1lbnQoYCR7U0VMRUNUT1JTLm1vZGFscy5hdmF0YXJ9IC5tb2RhbF9fZm9ybWApO1xuXG5jb25zdCBlZGl0TW9kYWxOYW1lSW5wdXQgPSBlZGl0Rm9ybUVsZW1lbnQ/LnF1ZXJ5U2VsZWN0b3IoXG4gIFNFTEVDVE9SUy5pbnB1dHMucHJvZmlsZU5hbWVcbik7XG5jb25zdCBlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0ID0gZWRpdEZvcm1FbGVtZW50Py5xdWVyeVNlbGVjdG9yKFxuICBTRUxFQ1RPUlMuaW5wdXRzLnByb2ZpbGVEZXNjcmlwdGlvblxuKTtcbmNvbnN0IHByb2ZpbGVOYW1lID0gZ2V0RWxlbWVudChTRUxFQ1RPUlMucHJvZmlsZU5hbWUpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZ2V0RWxlbWVudChTRUxFQ1RPUlMucHJvZmlsZURlc2NyaXB0aW9uKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXIgPSBnZXRFbGVtZW50KFNFTEVDVE9SUy5wcm9maWxlQXZhdGFyKTtcblxuY29uc3QgY2FyZE1vZGFsTmFtZUlucHV0ID0gYWRkQ2FyZEZvcm1FbGVtZW50Py5xdWVyeVNlbGVjdG9yKFxuICBTRUxFQ1RPUlMuaW5wdXRzLmNhcmROYW1lXG4pO1xuY29uc3QgY2FyZE1vZGFsTGlua0lucHV0ID0gYWRkQ2FyZEZvcm1FbGVtZW50Py5xdWVyeVNlbGVjdG9yKFxuICBTRUxFQ1RPUlMuaW5wdXRzLmNhcmRMaW5rXG4pO1xuY29uc3QgYXZhdGFyTW9kYWxMaW5rSW5wdXQgPSBhdmF0YXJGb3JtRWxlbWVudD8ucXVlcnlTZWxlY3RvcihcbiAgU0VMRUNUT1JTLmlucHV0cy5hdmF0YXJMaW5rXG4pO1xuXG5jb25zdCBwcmV2aWV3SW1hZ2UgPSBwcmV2aWV3TW9kYWw/LnF1ZXJ5U2VsZWN0b3IoU0VMRUNUT1JTLm1vZGFsSW1hZ2UpO1xuY29uc3QgcHJldmlld0NhcHRpb24gPSBwcmV2aWV3TW9kYWw/LnF1ZXJ5U2VsZWN0b3IoU0VMRUNUT1JTLm1vZGFsQ2FwdGlvbik7XG5cbi8vIENhcmQgZXZlbnQgaGFuZGxlcnNcbmZ1bmN0aW9uIGhhbmRsZUNhcmRMaWtlKGNhcmREYXRhLCBjYXJkTGlrZUJ0bikge1xuICBjb25zdCBpc0N1cnJlbnRseUxpa2VkID0gY2FyZExpa2VCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKFxuICAgIFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIlxuICApO1xuXG4gIGFwaVxuICAgIC5jaGFuZ2VMaWtlQ2FyZFN0YXR1cyhjYXJkRGF0YS5faWQsIGlzQ3VycmVudGx5TGlrZWQpXG4gICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XG4gICAgICBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XG4gICAgICBjYXJkRGF0YS5pc0xpa2VkID0gdXBkYXRlZENhcmQuaXNMaWtlZDtcbiAgICB9KVxuICAgIC5jYXRjaChoYW5kbGVFcnJvcik7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUNhcmREZWxldGUoY2FyZERhdGEsIGNhcmRFbGVtZW50KSB7XG4gIHBlbmRpbmdDYXJkRGVsZXRlID0geyBjYXJkRGF0YSwgY2FyZEVsZW1lbnQgfTtcbiAgb3Blbk1vZGFsKGNvbmZpcm1Nb2RhbCk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUNvbmZpcm1EZWxldGUoKSB7XG4gIGlmICghcGVuZGluZ0NhcmREZWxldGUpIHJldHVybjtcblxuICBjb25zdCB7IGNhcmREYXRhLCBjYXJkRWxlbWVudCB9ID0gcGVuZGluZ0NhcmREZWxldGU7XG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGNvbmZpcm1Nb2RhbC5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SUy5tb2RhbFN1Ym1pdEJ0bik7XG5cbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b24sIEJVVFRPTl9URVhULmRlbGV0aW5nLCBCVVRUT05fVEVYVC5kZWxldGUpO1xuXG4gIGFwaVxuICAgIC5kZWxldGVDYXJkKGNhcmREYXRhLl9pZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBjYXJkRWxlbWVudC5yZW1vdmUoKTtcbiAgICAgIGNsb3NlTW9kYWwoY29uZmlybU1vZGFsKTtcbiAgICAgIHBlbmRpbmdDYXJkRGVsZXRlID0gbnVsbDtcbiAgICB9KVxuICAgIC5jYXRjaChoYW5kbGVFcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICByZW5kZXJMb2FkaW5nKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgc3VibWl0QnV0dG9uLFxuICAgICAgICBCVVRUT05fVEVYVC5kZWxldGluZyxcbiAgICAgICAgQlVUVE9OX1RFWFQuZGVsZXRlXG4gICAgICApO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVJbWFnZVByZXZpZXcoY2FyZERhdGEpIHtcbiAgcHJldmlld0ltYWdlLnNyYyA9IGNhcmREYXRhLmxpbms7XG4gIHByZXZpZXdJbWFnZS5hbHQgPSBjYXJkRGF0YS5uYW1lO1xuICBwcmV2aWV3Q2FwdGlvbi50ZXh0Q29udGVudCA9IGNhcmREYXRhLm5hbWU7XG4gIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGNhcmREYXRhLCBjdXJyZW50VXNlcklkKSB7XG4gIGNvbnNvbGUubG9nKFwiQ3JlYXRpbmcgY2FyZCB3aXRoIGRhdGE6XCIsIGNhcmREYXRhKTsgLy8gRGVidWcgbG9nXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgY2FyZEltYWdlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihTRUxFQ1RPUlMuY2FyZEltYWdlKTtcbiAgY29uc3QgY2FyZFRpdGxlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihTRUxFQ1RPUlMuY2FyZFRpdGxlKTtcbiAgY29uc3QgY2FyZExpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SUy5jYXJkTGlrZUJ0bik7XG4gIGNvbnN0IGNhcmREZWxldGVCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SUy5jYXJkRGVsZXRlQnRuKTtcblxuICBjYXJkSW1hZ2Uuc3JjID0gY2FyZERhdGEubGluaztcbiAgY2FyZEltYWdlLmFsdCA9IGNhcmREYXRhLm5hbWU7XG4gIGNhcmRUaXRsZS50ZXh0Q29udGVudCA9IGNhcmREYXRhLm5hbWU7XG5cbiAgY29uc29sZS5sb2coXCJTZXR0aW5nIGltYWdlIHNyYyB0bzpcIiwgY2FyZERhdGEubGluayk7IC8vIERlYnVnIGxvZ1xuXG4gIC8vIFNldCBpbml0aWFsIGxpa2Ugc3RhdGVcbiAgaWYgKGNhcmREYXRhLmlzTGlrZWQpIHtcbiAgICBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XG4gIH1cblxuICAvLyBFdmVudCBsaXN0ZW5lcnNcbiAgY2FyZExpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gICAgaGFuZGxlQ2FyZExpa2UoY2FyZERhdGEsIGNhcmRMaWtlQnRuKVxuICApO1xuICBjYXJkRGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgIGhhbmRsZUNhcmREZWxldGUoY2FyZERhdGEsIGNhcmRFbGVtZW50KVxuICApO1xuICBjYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGhhbmRsZUltYWdlUHJldmlldyhjYXJkRGF0YSkpO1xuXG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn1cblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY0Nsb3NlKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NDbG9zZSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUVkaXRGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gZXZ0LnRhcmdldC5xdWVyeVNlbGVjdG9yKFNFTEVDVE9SUy5tb2RhbFN1Ym1pdEJ0bik7XG4gIGNvbnN0IG5hbWUgPSBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUudHJpbSgpO1xuICBjb25zdCBkZXNjcmlwdGlvbiA9IGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUudHJpbSgpO1xuXG4gIGlmIChuYW1lID09PSBcIlwiIHx8IGRlc2NyaXB0aW9uID09PSBcIlwiKSB7XG4gICAgYWxlcnQoXCJCb3RoIG5hbWUgYW5kIGRlc2NyaXB0aW9uIG11c3QgYmUgZmlsbGVkIG91dC5cIik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b24pO1xuXG4gIGFwaVxuICAgIC51cGRhdGVVc2VySW5mbyh7IG5hbWUsIGFib3V0OiBkZXNjcmlwdGlvbiB9KVxuICAgIC50aGVuKCh1c2VyRGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2VyRGF0YS5uYW1lO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gdXNlckRhdGEuYWJvdXQ7XG4gICAgICBjdXJyZW50VXNlciA9IHVzZXJEYXRhOyAvLyBVcGRhdGUgZ2xvYmFsIHVzZXIgZGF0YVxuICAgICAgY2xvc2VNb2RhbChlZGl0TW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGhhbmRsZUVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIHN1Ym1pdEJ1dHRvbik7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUFkZENhcmRTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdXR0b24gPSBldnQudGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoU0VMRUNUT1JTLm1vZGFsU3VibWl0QnRuKTtcbiAgY29uc3QgbmFtZSA9IGNhcmRNb2RhbE5hbWVJbnB1dC52YWx1ZS50cmltKCk7XG4gIGNvbnN0IGxpbmsgPSBjYXJkTW9kYWxMaW5rSW5wdXQudmFsdWUudHJpbSgpO1xuXG4gIGlmIChuYW1lID09PSBcIlwiIHx8IGxpbmsgPT09IFwiXCIpIHtcbiAgICBhbGVydChcIkJvdGggbmFtZSBhbmQgbGluayBtdXN0IGJlIGZpbGxlZCBvdXQuXCIpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHJlbmRlckxvYWRpbmcodHJ1ZSwgc3VibWl0QnV0dG9uLCBCVVRUT05fVEVYVC5jcmVhdGluZywgQlVUVE9OX1RFWFQuY3JlYXRlKTtcblxuICBhcGlcbiAgICAuYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSlcbiAgICAudGhlbigobmV3Q2FyZCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJOZXcgY2FyZCByZWNlaXZlZCBmcm9tIEFQSTpcIiwgbmV3Q2FyZCk7IC8vIERlYnVnIGxvZ1xuICAgICAgY29uc3QgbmV3Q2FyZEVsZW1lbnQgPSBjcmVhdGVDYXJkKG5ld0NhcmQsIGN1cnJlbnRVc2VyLl9pZCk7XG4gICAgICBjYXJkc0xpc3QucHJlcGVuZChuZXdDYXJkRWxlbWVudCk7XG4gICAgICBhZGRDYXJkRm9ybUVsZW1lbnQucmVzZXQoKTtcbiAgICAgIHJlc2V0Rm9ybShhZGRDYXJkRm9ybUVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpO1xuICAgICAgY2xvc2VNb2RhbChhZGRDYXJkTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGhhbmRsZUVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHJlbmRlckxvYWRpbmcoXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBzdWJtaXRCdXR0b24sXG4gICAgICAgIEJVVFRPTl9URVhULmNyZWF0aW5nLFxuICAgICAgICBCVVRUT05fVEVYVC5jcmVhdGVcbiAgICAgICk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGV2dC50YXJnZXQucXVlcnlTZWxlY3RvcihTRUxFQ1RPUlMubW9kYWxTdWJtaXRCdG4pO1xuICBjb25zdCBhdmF0YXIgPSBhdmF0YXJNb2RhbExpbmtJbnB1dC52YWx1ZS50cmltKCk7XG5cbiAgaWYgKGF2YXRhciA9PT0gXCJcIikge1xuICAgIGFsZXJ0KFwiQXZhdGFyIGxpbmsgbXVzdCBiZSBmaWxsZWQgb3V0LlwiKTtcbiAgICByZXR1cm47XG4gIH1cblxuICByZW5kZXJMb2FkaW5nKHRydWUsIHN1Ym1pdEJ1dHRvbik7XG5cbiAgYXBpXG4gICAgLnVwZGF0ZUF2YXRhcih7IGF2YXRhciB9KVxuICAgIC50aGVuKCh1c2VyRGF0YSkgPT4ge1xuICAgICAgc2V0UHJvZmlsZUF2YXRhcih1c2VyRGF0YS5hdmF0YXIsIHVzZXJEYXRhLm5hbWUgfHwgXCJVc2VyIEF2YXRhclwiKTtcbiAgICAgIGN1cnJlbnRVc2VyID0gdXNlckRhdGE7IC8vIFVwZGF0ZSBnbG9iYWwgdXNlciBkYXRhXG4gICAgICBhdmF0YXJGb3JtRWxlbWVudC5yZXNldCgpO1xuICAgICAgcmVzZXRGb3JtKGF2YXRhckZvcm1FbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKTtcbiAgICAgIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGhhbmRsZUVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIHN1Ym1pdEJ1dHRvbik7XG4gICAgfSk7XG59XG5cbi8vIEdsb2JhbCB2YXJpYWJsZSB0byBzdG9yZSBjdXJyZW50IHVzZXIgZGF0YVxubGV0IGN1cnJlbnRVc2VyID0gbnVsbDtcbi8vIEdsb2JhbCB2YXJpYWJsZXMgZm9yIHBlbmRpbmcgYWN0aW9uc1xubGV0IHBlbmRpbmdDYXJkRGVsZXRlID0gbnVsbDtcblxuLy8gVXRpbGl0eSBmdW5jdGlvbiB0byBzZXQgYXZhdGFyIHNhZmVseVxuZnVuY3Rpb24gc2V0UHJvZmlsZUF2YXRhcihhdmF0YXJVcmwsIGFsdFRleHQgPSBcIlVzZXIgQXZhdGFyXCIpIHtcbiAgaWYgKCFwcm9maWxlQXZhdGFyKSB7XG4gICAgY29uc29sZS53YXJuKFwicHJvZmlsZUF2YXRhciBlbGVtZW50IG5vdCBmb3VuZFwiKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBFbnN1cmUgd2UgaGF2ZSBhIHZhbGlkIFVSTFxuICBpZiAoIWF2YXRhclVybCB8fCBhdmF0YXJVcmwudHJpbSgpID09PSBcIlwiKSB7XG4gICAgY29uc29sZS5sb2coXCJObyBhdmF0YXIgVVJMIHByb3ZpZGVkLCBrZWVwaW5nIGN1cnJlbnQgYXZhdGFyXCIpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIE5vcm1hbGl6ZSB0aGUgVVJMcyBmb3IgY29tcGFyaXNvbiAoaGFuZGxlIHJlbGF0aXZlIHBhdGhzKVxuICBjb25zdCBjdXJyZW50U3JjID0gcHJvZmlsZUF2YXRhci5zcmM7XG4gIGNvbnN0IG5ld1VybCA9IGF2YXRhclVybC5zdGFydHNXaXRoKFwiLi9cIikgPyBhdmF0YXJVcmwgOiBcIi4vXCIgKyBhdmF0YXJVcmw7XG5cbiAgY29uc29sZS5sb2coXCJDdXJyZW50IGF2YXRhciBzcmM6XCIsIGN1cnJlbnRTcmMpO1xuICBjb25zb2xlLmxvZyhcIk5ldyBhdmF0YXIgVVJMOlwiLCBhdmF0YXJVcmwpO1xuXG4gIC8vIE9ubHkgc2V0IGlmIHdlIGhhdmUgYSB2YWxpZCBVUkwgYW5kIGl0J3MgZGlmZmVyZW50IGZyb20gY3VycmVudFxuICBpZiAoYXZhdGFyVXJsICE9PSBjdXJyZW50U3JjICYmICFjdXJyZW50U3JjLmVuZHNXaXRoKGF2YXRhclVybCkpIHtcbiAgICBjb25zb2xlLmxvZyhcIlNldHRpbmcgYXZhdGFyIHRvOlwiLCBhdmF0YXJVcmwpO1xuICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gYXZhdGFyVXJsO1xuICAgIHByb2ZpbGVBdmF0YXIuYWx0ID0gYWx0VGV4dDtcblxuICAgIC8vIEFkZCBlcnJvciBoYW5kbGluZyBmb3IgYXZhdGFyIGxvYWRpbmdcbiAgICBwcm9maWxlQXZhdGFyLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJBdmF0YXIgZmFpbGVkIHRvIGxvYWQsIHVzaW5nIGZhbGxiYWNrXCIpO1xuICAgICAgdGhpcy5zcmMgPSBcImltYWdlcy9hdmF0YXIuanBnXCI7XG4gICAgICB0aGlzLmFsdCA9IFwiRGVmYXVsdCBBdmF0YXJcIjtcbiAgICAgIHRoaXMub25lcnJvciA9IG51bGw7IC8vIFByZXZlbnQgaW5maW5pdGUgbG9vcFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5sb2coXCJBdmF0YXIgYWxyZWFkeSBzZXQgdG8gdGhpcyBVUkwsIHNraXBwaW5nXCIpO1xuICB9XG59XG5cbi8vIEluaXRpYWxpemUgdGhlIGFwcGxpY2F0aW9uXG5mdW5jdGlvbiBpbml0aWFsaXplQXBwKCkge1xuICAvLyBEb24ndCBzZXQgZGVmYXVsdCBhdmF0YXIgaGVyZSBzaW5jZSBpdCdzIGFscmVhZHkgaW4gSFRNTFxuICBjb25zb2xlLmxvZyhcIkluaXRpYWxpemluZyBhcHAuLi5cIik7XG5cbiAgLy8gTG9hZCB1c2VyIHByb2ZpbGUgYW5kIGNhcmRzIGZyb20gQVBJXG4gIGFwaVxuICAgIC5nZXRBcHBJbmZvKClcbiAgICAudGhlbigoW3VzZXJEYXRhLCBjYXJkc0RhdGFdKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIlVzZXIgZGF0YSByZWNlaXZlZDpcIiwgdXNlckRhdGEpOyAvLyBEZWJ1ZyBsb2cgICAgICAvLyBTdG9yZSBjdXJyZW50IHVzZXIgZGF0YVxuICAgICAgY3VycmVudFVzZXIgPSB1c2VyRGF0YTtcblxuICAgICAgLy8gVXBkYXRlIHByb2ZpbGUgaW5mb3JtYXRpb25cbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlckRhdGEubmFtZSB8fCBcIlVzZXIgTmFtZVwiO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gdXNlckRhdGEuYWJvdXQgfHwgXCJVc2VyIERlc2NyaXB0aW9uXCI7XG5cbiAgICAgIC8vIFVwZGF0ZSBhdmF0YXIgdXNpbmcgdGhlIGNlbnRyYWxpemVkIGZ1bmN0aW9uIChvbmx5IGlmIHVzZXIgaGFzIGEgcmVhbCBjdXN0b20gYXZhdGFyKVxuICAgICAgLy8gSWdub3JlIHBsYWNlaG9sZGVyIGF2YXRhcnMgZnJvbSBwcmFjdGljdW0tY29udGVudFxuICAgICAgaWYgKFxuICAgICAgICB1c2VyRGF0YS5hdmF0YXIgJiZcbiAgICAgICAgIXVzZXJEYXRhLmF2YXRhci5pbmNsdWRlcyhcInByYWN0aWN1bS1jb250ZW50LnMzLmFtYXpvbmF3cy5jb21cIilcbiAgICAgICkge1xuICAgICAgICBzZXRQcm9maWxlQXZhdGFyKHVzZXJEYXRhLmF2YXRhciwgdXNlckRhdGEubmFtZSB8fCBcIlVzZXIgQXZhdGFyXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgXCJVc2luZyBkZWZhdWx0IGF2YXRhciAobm8gY3VzdG9tIGF2YXRhciBvciBwbGFjZWhvbGRlciBkZXRlY3RlZClcIlxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBSZW5kZXIgY2FyZHNcbiAgICAgIHJlbmRlckNhcmRzKGNhcmRzRGF0YSk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGluaXRpYWxpemUgYXBwOlwiLCBlcnJvcik7XG5cbiAgICAgIC8vIEZhbGxiYWNrOiBzZXQgZGVmYXVsdCBhdmF0YXIgYW5kIHByb2ZpbGUgaW5mb1xuICAgICAgc2V0UHJvZmlsZUF2YXRhcihcIi4vaW1hZ2VzL2F2YXRhci5qcGdcIiwgXCJEZWZhdWx0IEF2YXRhclwiKTtcbiAgICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gXCJVc2VyIE5hbWVcIjtcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IFwiVXNlciBEZXNjcmlwdGlvblwiO1xuXG4gICAgICAvLyBGYWxsYmFjayB0byBsb2NhbCBkYXRhXG4gICAgICByZW5kZXJDYXJkcyhpbml0aWFsQ2FyZHMpO1xuICAgIH0pO1xufVxuXG4vLyBGdW5jdGlvbiB0byByZW5kZXIgY2FyZHNcbmZ1bmN0aW9uIHJlbmRlckNhcmRzKGNhcmRzRGF0YSkge1xuICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblxuICBjYXJkc0RhdGEuZm9yRWFjaCgoY2FyZERhdGEpID0+IHtcbiAgICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQoXG4gICAgICBjYXJkRGF0YSxcbiAgICAgIGN1cnJlbnRVc2VyID8gY3VycmVudFVzZXIuX2lkIDogbnVsbFxuICAgICk7XG4gICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoY2FyZEVsZW1lbnQpO1xuICB9KTtcblxuICBjYXJkc0xpc3QuaW5uZXJIVE1MID0gXCJcIjsgLy8gQ2xlYXIgZXhpc3RpbmcgY2FyZHNcbiAgY2FyZHNMaXN0LmFwcGVuZENoaWxkKGZyYWdtZW50KTtcbn1cblxuLy8gSW5pdGlhbCBjYXJkIHJlbmRlcmluZyAtIHJlcGxhY2Ugd2l0aCBBUEkgaW5pdGlhbGl6YXRpb25cbi8vIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuLy8gaW5pdGlhbENhcmRzLmZvckVhY2goKGNhcmREYXRhKSA9PiB7XG4vLyAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JlYXRlQ2FyZChjYXJkRGF0YSk7XG4vLyAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGNhcmRFbGVtZW50KTtcbi8vIH0pO1xuLy8gY2FyZHNMaXN0LnByZXBlbmQoZnJhZ21lbnQpO1xuXG4vLyBJbml0aWFsaXplIHRoZSBhcHBcbmluaXRpYWxpemVBcHAoKTtcblxuLy8gRXZlbnQgbGlzdGVuZXJzIHNldHVwXG5mdW5jdGlvbiBzZXR1cEV2ZW50TGlzdGVuZXJzKCkge1xuICAvLyBGb3JtIHN1Ym1pc3Npb25zXG4gIGFkZENhcmRGb3JtRWxlbWVudD8uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBZGRDYXJkU3VibWl0KTtcbiAgZWRpdEZvcm1FbGVtZW50Py5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRGb3JtU3VibWl0KTtcbiAgYXZhdGFyRm9ybUVsZW1lbnQ/LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQXZhdGFyU3VibWl0KTtcblxuICAvLyBDb25maXJtYXRpb24gbW9kYWxcbiAgY29uc3QgY29uZmlybUJ1dHRvbiA9IGNvbmZpcm1Nb2RhbD8ucXVlcnlTZWxlY3RvcihTRUxFQ1RPUlMubW9kYWxTdWJtaXRCdG4pO1xuICBjb25zdCBjYW5jZWxCdXR0b24gPSBjb25maXJtTW9kYWw/LnF1ZXJ5U2VsZWN0b3IoU0VMRUNUT1JTLm1vZGFsQ2FuY2VsQnRuKTtcblxuICBjb25maXJtQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlQ29uZmlybURlbGV0ZSk7XG4gIGNhbmNlbEJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjbG9zZU1vZGFsKGNvbmZpcm1Nb2RhbCk7XG4gICAgcGVuZGluZ0NhcmREZWxldGUgPSBudWxsO1xuICB9KTtcblxuICAvLyBCdXR0b24gY2xpY2tzXG4gIHByb2ZpbGVFZGl0QnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNsZWFyVmFsaWRhdGlvbihlZGl0Rm9ybUVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpO1xuXG4gICAgaWYgKGN1cnJlbnRVc2VyKSB7XG4gICAgICBlZGl0TW9kYWxOYW1lSW5wdXQudmFsdWUgPSBjdXJyZW50VXNlci5uYW1lO1xuICAgICAgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IGN1cnJlbnRVc2VyLmFib3V0IHx8IFwiXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVkaXRNb2RhbE5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xuICAgICAgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcbiAgICB9XG5cbiAgICBvcGVuTW9kYWwoZWRpdE1vZGFsKTtcbiAgfSk7XG5cbiAgY2FyZEFkZEJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICByZXNldEZvcm0oYWRkQ2FyZEZvcm1FbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKTtcbiAgICBvcGVuTW9kYWwoYWRkQ2FyZE1vZGFsKTtcbiAgfSk7XG5cbiAgcHJvZmlsZUF2YXRhckVkaXRCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgcmVzZXRGb3JtKGF2YXRhckZvcm1FbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKTtcbiAgICBvcGVuTW9kYWwoYXZhdGFyTW9kYWwpO1xuICB9KTtcblxuICAvLyBNb2RhbCBjbG9zZSBidXR0b25zXG4gIGNvbnN0IGNsb3NlQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoU0VMRUNUT1JTLmNsb3NlQnV0dG9ucyk7XG4gIGNsb3NlQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vZGFsID0gYnV0dG9uLmNsb3Nlc3QoXCIubW9kYWxcIik7XG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcblxuICAgICAgLy8gQ2xlYXIgcGVuZGluZyBhY3Rpb25zIHdoZW4gY2xvc2luZyBjb25maXJtYXRpb24gbW9kYWxcbiAgICAgIGlmIChtb2RhbCA9PT0gY29uZmlybU1vZGFsKSB7XG4gICAgICAgIHBlbmRpbmdDYXJkRGVsZXRlID0gbnVsbDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gTW9kYWwgb3ZlcmxheSBjbGlja3NcbiAgY29uc3QgbW9kYWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbFwiKTtcbiAgbW9kYWxzLmZvckVhY2goKG1vZGFsKSA9PiB7XG4gICAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4ge1xuICAgICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gbW9kYWwpIHtcbiAgICAgICAgY2xvc2VNb2RhbChtb2RhbCk7XG5cbiAgICAgICAgLy8gQ2xlYXIgcGVuZGluZyBhY3Rpb25zIHdoZW4gY2xvc2luZyBjb25maXJtYXRpb24gbW9kYWxcbiAgICAgICAgaWYgKG1vZGFsID09PSBjb25maXJtTW9kYWwpIHtcbiAgICAgICAgICBwZW5kaW5nQ2FyZERlbGV0ZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59XG5cbi8vIEluaXRpYWxpemUgdGhlIGFwcFxuaW5pdGlhbGl6ZUFwcCgpO1xuc2V0dXBFdmVudExpc3RlbmVycygpO1xuIiwiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cblxuICAgIC8vIE1vcmUgZGV0YWlsZWQgZXJyb3IgaGFuZGxpbmdcbiAgICByZXR1cm4gcmVzXG4gICAgICAuanNvbigpXG4gICAgICAudGhlbigoZXJyb3JEYXRhKSA9PiB7XG4gICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVycm9yRGF0YS5tZXNzYWdlIHx8IGBFcnJvcjogJHtyZXMuc3RhdHVzfWA7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCh7IHN0YXR1czogcmVzLnN0YXR1cywgbWVzc2FnZTogZXJyb3JNZXNzYWdlIH0pO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICAgIC8vIElmIHJlc3BvbnNlIGRvZXNuJ3QgaGF2ZSBKU09OLCB1c2Ugc3RhdHVzIHRleHRcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHtcbiAgICAgICAgICBzdGF0dXM6IHJlcy5zdGF0dXMsXG4gICAgICAgICAgbWVzc2FnZTogcmVzLnN0YXR1c1RleHQgfHwgYEVycm9yOiAke3Jlcy5zdGF0dXN9YCxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIF9yZXF1ZXN0KHVybCwgb3B0aW9ucykge1xuICAgIHJldHVybiBmZXRjaCh1cmwsIG9wdGlvbnMpLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICAvLyBVc2VyIFByb2ZpbGUgTWV0aG9kc1xuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSk7XG4gIH1cblxuICB1cGRhdGVVc2VySW5mbyhkYXRhKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZUF2YXRhcihkYXRhKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgfSk7XG4gIH1cblxuICAvLyBDYXJkIE1ldGhvZHNcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG4gIGFkZENhcmQoZGF0YSkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIExpa2UgTWV0aG9kc1xuICBhZGRMaWtlKGNhcmRJZCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSk7XG4gIH1cblxuICByZW1vdmVMaWtlKGNhcmRJZCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSk7XG4gIH1cblxuICAvLyBVdGlsaXR5IG1ldGhvZCBmb3IgdG9nZ2xpbmcgbGlrZXNcbiAgY2hhbmdlTGlrZUNhcmRTdGF0dXMoY2FyZElkLCBpc0xpa2VkKSB7XG4gICAgcmV0dXJuIGlzTGlrZWQgPyB0aGlzLnJlbW92ZUxpa2UoY2FyZElkKSA6IHRoaXMuYWRkTGlrZShjYXJkSWQpO1xuICB9XG5cbiAgLy8gQXBwIEluaXRpYWxpemF0aW9uIE1ldGhvZFxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRVc2VySW5mbygpLCB0aGlzLmdldEluaXRpYWxDYXJkcygpXSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbImhpZGVJbnB1dEVycm9yIiwiZm9ybSIsImlucHV0RWxlbWVudCIsImNvbmZpZyIsImVycm9yRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiZXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImRpc2FibGVkIiwiYWRkIiwiY2xlYXJWYWxpZGF0aW9uIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImZvckVhY2giLCJyZXNldEZvcm0iLCJyZXNldCIsIkVSUk9SX01FU1NBR0VTIiwiU0VMRUNUT1JTIiwiQlVUVE9OX1RFWFQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsInRoZW4iLCJlcnJvckRhdGEiLCJlcnJvck1lc3NhZ2UiLCJtZXNzYWdlIiwic3RhdHVzIiwiUHJvbWlzZSIsInJlamVjdCIsImNhdGNoIiwic3RhdHVzVGV4dCIsIl9yZXF1ZXN0IiwidXJsIiwib3B0aW9ucyIsImZldGNoIiwiZ2V0VXNlckluZm8iLCJ1cGRhdGVVc2VySW5mbyIsImRhdGEiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInVwZGF0ZUF2YXRhciIsImdldEluaXRpYWxDYXJkcyIsImFkZENhcmQiLCJkZWxldGVDYXJkIiwiY2FyZElkIiwiYWRkTGlrZSIsInJlbW92ZUxpa2UiLCJjaGFuZ2VMaWtlQ2FyZFN0YXR1cyIsImlzTGlrZWQiLCJnZXRBcHBJbmZvIiwiYWxsIiwiYXV0aG9yaXphdGlvbiIsImluaXRpYWxDYXJkcyIsIm5hbWUiLCJsaW5rIiwiaGFuZGxlRXNjQ2xvc2UiLCJldnQiLCJrZXkiLCJvcGVuZWRNb2RhbCIsImRvY3VtZW50IiwiY2xvc2VNb2RhbCIsInJlbmRlckxvYWRpbmciLCJpc0xvYWRpbmciLCJidXR0b24iLCJsb2FkaW5nVGV4dCIsImRlZmF1bHRUZXh0IiwiaGFuZGxlRXJyb3IiLCJlcnJvciIsImNvbnNvbGUiLCJhbGVydCIsImdldEVsZW1lbnQiLCJzZWxlY3RvciIsImVsZW1lbnQiLCJ3YXJuIiwidmFsaWRhdGlvbkNvbmZpZyIsImZvcm1TZWxlY3RvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJzaG93SW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJjYXJkc0xpc3QiLCJjYXJkVGVtcGxhdGUiLCJjb250ZW50IiwicHJvZmlsZUVkaXRCdXR0b24iLCJjYXJkQWRkQnV0dG9uIiwicHJvZmlsZUF2YXRhckVkaXRCdXR0b24iLCJlZGl0TW9kYWwiLCJhZGRDYXJkTW9kYWwiLCJwcmV2aWV3TW9kYWwiLCJhdmF0YXJNb2RhbCIsImNvbmZpcm1Nb2RhbCIsImVkaXRGb3JtRWxlbWVudCIsImFkZENhcmRGb3JtRWxlbWVudCIsImF2YXRhckZvcm1FbGVtZW50IiwiZWRpdE1vZGFsTmFtZUlucHV0IiwiZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dCIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2NyaXB0aW9uIiwicHJvZmlsZUF2YXRhciIsImNhcmRNb2RhbE5hbWVJbnB1dCIsImNhcmRNb2RhbExpbmtJbnB1dCIsImF2YXRhck1vZGFsTGlua0lucHV0IiwicHJldmlld0ltYWdlIiwicHJldmlld0NhcHRpb24iLCJoYW5kbGVDb25maXJtRGVsZXRlIiwicGVuZGluZ0NhcmREZWxldGUiLCJjYXJkRGF0YSIsImNhcmRFbGVtZW50Iiwic3VibWl0QnV0dG9uIiwiX2lkIiwiZmluYWxseSIsImNyZWF0ZUNhcmQiLCJjdXJyZW50VXNlcklkIiwibG9nIiwiY2xvbmVOb2RlIiwiY2FyZEltYWdlIiwiY2FyZFRpdGxlIiwiY2FyZExpa2VCdG4iLCJjYXJkRGVsZXRlQnRuIiwic3JjIiwiYWx0IiwiaXNDdXJyZW50bHlMaWtlZCIsImNvbnRhaW5zIiwidXBkYXRlZENhcmQiLCJ0b2dnbGUiLCJoYW5kbGVDYXJkTGlrZSIsIm9wZW5Nb2RhbCIsImhhbmRsZUNhcmREZWxldGUiLCJoYW5kbGVJbWFnZVByZXZpZXciLCJtb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJoYW5kbGVFZGl0Rm9ybVN1Ym1pdCIsInByZXZlbnREZWZhdWx0IiwidGFyZ2V0IiwidmFsdWUiLCJ0cmltIiwiZGVzY3JpcHRpb24iLCJhYm91dCIsInVzZXJEYXRhIiwiY3VycmVudFVzZXIiLCJoYW5kbGVBZGRDYXJkU3VibWl0IiwibmV3Q2FyZCIsIm5ld0NhcmRFbGVtZW50IiwicHJlcGVuZCIsImhhbmRsZUF2YXRhclN1Ym1pdCIsImF2YXRhciIsInNldFByb2ZpbGVBdmF0YXIiLCJhdmF0YXJVcmwiLCJhbHRUZXh0IiwiY3VycmVudFNyYyIsInN0YXJ0c1dpdGgiLCJlbmRzV2l0aCIsIm9uZXJyb3IiLCJpbml0aWFsaXplQXBwIiwiY2FyZHNEYXRhIiwiaW5jbHVkZXMiLCJyZW5kZXJDYXJkcyIsImZyYWdtZW50IiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImFwcGVuZENoaWxkIiwiaW5uZXJIVE1MIiwiY29uZmlybUJ1dHRvbiIsImNhbmNlbEJ1dHRvbiIsImNsb3Nlc3QiLCJldmVudCIsInNldHVwRXZlbnRMaXN0ZW5lcnMiXSwic291cmNlUm9vdCI6IiJ9